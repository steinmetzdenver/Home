<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
<!--     note - use https://drive.google.com/uc?export=view&id=    then up to /view -->
     <script src="https://drive.google.com/uc?export=view&id=1fIkz4VNa04gSiB47r9Ww12McdlIuzPUL"></script> 
     <link rel="stylesheet" type="text/css" href="newShoppingCss.css">
    <title>Tool Items</title>
</head>
<body>
  <h1>Tools</h1>
  <div id="shop-page">
    <div id="page-container">
            <div id="item-list">
            </div>
            <div  id="shopping-cart-list">
              <div id="shopping-cart">
                  <h3 >Your Shopping Cart</h3>
                  <hr id="fancy-line"></hr>
              </div>
              <div id="cart-total">
                <hr style="border-top: 1px solid #333;margin-right:10px"></hr>
                <span>Total Purchase: $</span><span id="total-purchase"></span>
                <div id="test-div"></div>
                <!--***********google form container****** -->
                <div class="form-container">
                    <form name="gform" id="gform" enctype="text/plain"  action="https://docs.google.com/forms/d/e/1FAIpQLSc7rtVng25ALoFQW1Hd51N0UKsTcBIVFKQL03i5NHLj5NYocg/formResponse?" target="hidden_iframe" >
                      First Name:<br>
                      <input type="text" name="entry.2005620554" id="entry.2005620554" style="width:200px" placeholder="Enter your first name" required><br>
                      Last Name:<br>
                      <input type="text" name="entry.1610227697" id="entry.1610227697" style="width:250px" placeholder="Enter your last name" required><br>
                      Email:<br>
                      <input type="email" name="entry.1045781291" id="entry.1045781291" style="width:300px" placeholder="Enter your email address" required><br>
                      Shipping Address:<br>
                      <input type="text" name="entry.1065046570" id="entry.1065046570" style="width:600px" placeholder="Enter your shipping address" required><br>
                      Phone:<br>
                      <input type="number" name="entry.1166974658" id="entry.1166974658" style="width:200px" placeholder="Enter your phone number" required><br>
                      <textarea style="display:none" name="entry.839337160" id="entry.839337160" ></textarea><br>
                      <script>
                           function doFade(){
                              let name = document.getElementById("entry.2005620554").value.toUpperCase(); 
                                document.getElementById("gform").style="display:none";
                              document.getElementById("response").innerHTML = '<h2 style="text-align:center"> Thank you ' + name + ', you will receive an email invoice with shipping costs applied shortly. <h2>';
                        }  
                        function getPurchaseSummary(){
                          let cartRows = document.getElementsByClassName("cart-item-row")[0];
                          let price="";
                          let quantity="";
                          let description="";
                          let itemID="";
                          let priceObj = {};
                          let priceArray = [];
                          let totalSaleObj = {};
                          for (let i=0;i<cartRows.length;i++)
                              {   
                                  let cartRow = cartRows[i];
                                  price = cartRow.getElementsByClassName("cart-price")[0].innerText;
                                  quantity = cartRow.getElementsByClassName("quantity")[0].value;
                                  description = cartRow.getElementsByClassName("cart-item-description")[0].innerText;
                                  itemID = cartRow.getElementsByClassName("cart-item-id")[0].innerText;
                                  priceObj = {ID:itemID,Description:description,Quantity:quantity,price:price}
                                  priceArray.push(priceObj);
                            }
                            let totalPrice = document.getElementById("total-purchase").innerText;
                            totalSaleObj = {TotalSale:totalPrice};
                            priceArray.push(totalSaleObj);
                            let sendStr = JSON.stringify(priceArray);
                            document.getElementsByTagName("textarea").innerText = sendStr;
                             setTimeout(doFade(),4000); 
                         }
                      </script>
                      <input type="submit" value="Request Invoice" onclick="getPurchaseSummary()">
                    </form>
                </div>
                <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>
                <div id="response"></div>
                <!--*********** end google form container****** -->
              </div>
            </div>
        <script>
          document.addEventListener("DOMContentLoaded", function(){
          //*************load item photos from file*******
          accessoryPhotos.forEach(function(item){
            let container = document.getElementById("item-list");
            let imageRow = '<div class="img-row"> <img src="' + item.url +  '" class="row-image"></div>';
            let spanDescription = '<span class="item-description">' + item.description + '</span>' + '<br>';
            let spanId = '<span class="item-id">Item# ' + item.id + ' </span>' + '<br>';
            let spanPrice = '<span>$</span>' + '<span class="item-price">' + item.price + ' </span>' + '<br>';
            let addToCartButton = '<button class="add-to-cart-button" type="button"> Add To Cart </button>';
            let spanGroup = '<div class="span-group">' +  spanDescription + spanId + spanPrice + addToCartButton + '</div>';
            let divRow = document.createElement("div");
            divRow.setAttribute("class","item-row");
            divRow.innerHTML =  imageRow + spanGroup;
            container.appendChild(divRow); 
          })

          // end load item photos from file************

          // ************begin item image mouseover event*************
          let itemRows = document.getElementsByClassName("row-image");
          for (let i=0;i<itemRows.length;i++){
            let itemRow=itemRows[i];
            itemRow.addEventListener("mouseover",
            function(){
              this.style="height:400px;width:400px;transition-duration:4s"});
              itemRow.addEventListener("mouseout",
            function(){
              this.style="height:100px;width:100px;transition:4s"});       
              }

          // **************end item image mouseover event*****************

          //*****check if item is already in cart***************
            function checkCartItemExists(newItem){
              let cartRows = document.getElementsByClassName("cart-item-row");
              let proceed = true;
            for (let i=0;i<cartRows.length;i++)
            {   
                let cartRow = cartRows[i];
                let rowID = cartRow.getElementsByClassName("cart-item-id")[0].innerText;
                if (rowID == newItem) {proceed = false}
            } return proceed;}

          // ****************** begin add to shopping cart **************
              let addToCartButtons = document.getElementsByClassName("add-to-cart-button");
              for (let i=0;i<addToCartButtons.length;i++)
              {
                let addToCartButton = addToCartButtons[i];
                addToCartButton.addEventListener("click", addToShoppingCart);
              }

            function addToShoppingCart(event)
            {
              let buttonClicked = event.target;
              let rowGroup = buttonClicked.parentElement.parentElement;
              let price = rowGroup.getElementsByClassName("item-price")[0].innerText;
              let itemID = rowGroup.getElementsByClassName("item-id")[0].innerText;
              let description = rowGroup.getElementsByClassName("item-description")[0].innerText;
              let imageURL = rowGroup.getElementsByClassName("row-image")[0].src;
                    //****if item already in shopping cart send alert*****
                    if(checkCartItemExists(itemID)){
                    let imageRow = '<div class="cart-img-row"> <img src="' + imageURL +  '" class="cart-row-image"></div>';
                    let spanDescription = '<span class="cart-item-description">' + description + '</span>' + '<br>';
                    let spanId = '<span class="cart-item-id">' + itemID + ' </span>' + '<br>';
                    let spanPrice = '<span>$</span>' + '<span class="cart-price">' + price + '</span>' + '<span>, Quantity: </span>' + '<input class="quantity" " type="number" value="1" style="width:30px;font-size:12px;text-align:right"/> <br>';
                    let removeButton = '<button class="remove-button" type="button"> Remove </button>';
                    let spanGroup = '<div class="cart-span-group">' +  spanDescription + spanId + spanPrice + removeButton + '</div>';

                    let divRow = document.createElement("div");
                    divRow.setAttribute("class","cart-item-row");
                    divRow.innerHTML =  imageRow + spanGroup;
                    document.getElementById("shopping-cart").append(divRow);
                    updateTotal();
                    let removeCartButtons = document.getElementsByClassName("remove-button");
                    for (let i=0;i<removeCartButtons.length;i++)
                    {
                      let removeCartButton = removeCartButtons[i];
                      removeCartButton.addEventListener("click", removeCartItem);
                    }
                    let quantityChanges = document.getElementsByClassName("quantity");
                    for (let i=0;i<quantityChanges.length;i++)
                      {
                        let quantityChange = quantityChanges[i];
                        quantityChange.addEventListener("click", changeQuantity);
                      }
                    }
                    else {alert("You have already added this item to your shopping cart")}
                    //******end if item already in shopping cart alert****
            } 
            // ************* end add to shopping cart****************
            //**************** begin remove item from shopping cart*************8         
          function removeCartItem(event){
            let removeButton = event.target;
            let removeItem = removeButton.parentElement.parentElement;
            removeItem.remove();
            updateTotal();
            }
            //****************** end remove item from shopping cart************
            //************** begin change quantity input event handler*********
            function changeQuantity(event)
            {   input = event.target;
                if ((input.value==" ") || (input.value <=0))
                {   alert("Please select a quantity greater than 0")
                    input.value = 1;
                }
                updateTotal()
            }
            //**************** end change quantity input event handler*********
            //********** begin update total purchase price*******************
            function updateTotal(){
              let totalPrice = 0;
              let quantity = 1;
              let cartRows = document.getElementsByClassName("cart-item-row");
            for (let i=0;i<cartRows.length;i++)
            {   
                let cartRow = cartRows[i];
                let price = parseFloat(cartRow.getElementsByClassName("cart-price")[0].innerText);
                quantity = parseInt(cartRow.getElementsByClassName("quantity")[0].value);
                totalPrice = totalPrice + (price*quantity);  
                totalPrice = Math.round(totalPrice*100)/100;  
            }
            document.getElementById("total-purchase").innerHTML = totalPrice;}
            //************** end update total purchase price********
          });  //end document ready
        </script>
    </div> 
  </div>
    <!-- End Shop Page -->
</body>
</html>
